server:
  port: 10001

spring:
  config:
    import: optional:file:.env[.properties]

  datasource:
    url: ${MYSQL_URL}
    username: ${MYSQL_USERNAME}
    password: ${MYSQL_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    show-sql: true
    database: mysql
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        format_sql: true

  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher

logging:
  config: classpath:logback-spring.xml

openweathermap:
  key: ENC(jBdVosbeOteUGOYStf6IVmulQvNc7RF5ZItkCQWkZWNymscNbarTQEbf/r64Ejvy7enyRTmrDHrtbycRIyheYlcFqZn13oy8AlsyT1s1Yso=)

jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD}

springdoc:
  swagger-ui:
    path: /swagger
    operations-sorter: method
    display-request-duration: true
    persist-authorization: true
  api-docs:
    path: /v3/api-docs
  default-produces-media-type: application/json






server {
    listen 80;
    server_name virtue-project.info;

    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl;
    server_name virtue-project.info;

    ssl_certificate     /etc/letsencrypt/live/virtue-project.info/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/virtue-project.info/privkey.pem;

    location /zb-weather-diary/ {
        proxy_pass http://localhost:10001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


server {
    listen 443 ssl;
    server_name virtue-project.info;

    ssl_certificate     /etc/letsencrypt/live/virtue-project.info/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/virtue-project.info/privkey.pem;

    # Swagger 진입점
    location = /zb-weather-diary {
        return 301 /zb-weather-diary/;
    }

    location /zb-weather-diary/ {
        proxy_pass http://localhost:10001/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Swagger HTML 렌더링
    location /zb-weather-diary/ {
        proxy_pass http://localhost:10001/swagger-ui/index.html;

        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # HTML 내부 정적 경로 재매핑
        sub_filter '/swagger-ui/' '/zb-weather-diary/swagger-ui/';
        sub_filter_once off;
        proxy_set_header Accept-Encoding "";
    }

    # 실제 정적 파일 요청 매핑
    location /zb-weather-diary/swagger-ui/ {
        proxy_pass http://localhost:10001/swagger-ui/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # API 문서 JSON
    location /zb-weather-diary/v3/api-docs {
        proxy_pass http://localhost:10001/v3/api-docs;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}